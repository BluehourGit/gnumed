#reads the filelist generated by bootstrap-parse and approximates a 
#gnumed schema install as per redo-max.sh , which is broken currently in cygwin.

sql_path=../../server/sql
bootstrap_path=../../server/bootstrap
python bootstrap-parse.py $bootstrap_path/bootstrap-monolithic_core.conf filelist;

echo 
echo
echo **  THIS SCRIPT assumes the root windows postgres user is postgres.

echo dropdb -Upostgres -h127.0.0.1 gnumed
dropdb  -h127.0.0.1 -Upostgres gnumed
echo createdb -h.127.0.0.1 -Upostgres gnumed
createdb -h127.0.0.1 -Upostgres gnumed

echo creatuser -h127.0.0.1 -Upostgres -a -d -e -P  gm-dbowner 
createuser -h127.0.0.1 -Upostgres -a -d -e -P gm-dbowner 
echo enter password for gm-dbowner
createlang -d gnumed -h127.0.0.1 -Ugm-dbowner plpgsql
rm all
touch all
for  x in `cat filelist`;do
	cat $sql_path/$x >> all
done

#some of the country specific data is needed, such as enum_ext_id_types
sh append_local_schema.sh

x=all
echo psql -Ugm-dbowner -f $x -h127.0.0.1 gnumed
echo **  enter password for gm-dbowner
psql -f$x -Ugm-dbowner -h127.0.0.1 gnumed 2>> err


sh append_test_data.sh

