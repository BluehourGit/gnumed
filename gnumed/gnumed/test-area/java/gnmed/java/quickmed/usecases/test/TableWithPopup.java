/*
 * TableWithPopup.java
 *
 * Created on 3 August 2003, 17:58
 */

package quickmed.usecases.test;
import javax.swing.*;
import javax.swing.table.*;
import java.util.logging.*;
import java.beans.*;
/**
 *
 * @author  sjtan
 */
public class TableWithPopup extends javax.swing.JPanel {
    static int MENU_H_OFFSET = 20;
    /** Creates new form TableWithPopup */
    public TableWithPopup() {
        initComponents();
        jTable1.setDefaultRenderer(java.util.Date.class, new ShortDateCellRenderer());
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPopupMenu1 = new javax.swing.JPopupMenu();
        add_jMenuItem1 = new javax.swing.JMenuItem();
        delete_jMenuItem2 = new javax.swing.JMenuItem();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();

        add_jMenuItem1.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_A, 0));
        add_jMenuItem1.setText(java.util.ResourceBundle.getBundle("SummaryTerms").getString("add"));
        add_jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addObjectAction(evt);
            }
        });

        jPopupMenu1.add(add_jMenuItem1);

        delete_jMenuItem2.setText(java.util.ResourceBundle.getBundle("SummaryTerms").getString("delete"));
        delete_jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteObjectAction(evt);
            }
        });

        jPopupMenu1.add(delete_jMenuItem2);

        setLayout(new java.awt.BorderLayout());

        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                mousePressedCheckForPopup(evt);
            }
        });

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jTable1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                mousePressedShowPopup(evt);
            }
        });

        jScrollPane1.setViewportView(jTable1);

        add(jScrollPane1, java.awt.BorderLayout.CENTER);

    }//GEN-END:initComponents

    private void deleteObjectAction(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deleteObjectAction
        // Add your handling code here:
         if ( jTable1.getModel()  instanceof ListObjectTableModel) {
            ListObjectTableModel model = (ListObjectTableModel)jTable1.getModel();
            int row = jTable1.getSelectedRow();
                
            if ( JOptionPane.YES_OPTION == 
            JOptionPane.showConfirmDialog(jTable1, "Are you sure you wish to delete " +model.getDisplayString(model.getList().get(row)) ) ) {
                model.remove(row);
            }
            
        }
    }//GEN-LAST:event_deleteObjectAction
    
    private void addObjectAction(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addObjectAction
        // Add your handling code here:
        if ( jTable1.getModel()  instanceof ListObjectTableModel) {
            ListObjectTableModel model = (ListObjectTableModel) jTable1.getModel();
            model.newObject();
        }
    }//GEN-LAST:event_addObjectAction
    
    private void mousePressedShowPopup(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_mousePressedShowPopup
        // Add your handling code here:
        //        System.out.println("GOT EVENT "+evt);
        if ( (evt.getButton() ==  evt.BUTTON3 || evt.getButton() ==  evt.BUTTON2 ) && !jPopupMenu1.isVisible() ) {
            jPopupMenu1.pack();
            jPopupMenu1.show( this, evt.getX() + MENU_H_OFFSET, evt.getY());
            //  System.out.println("SHOWING "+ jPopupMenu1);
        }
    }//GEN-LAST:event_mousePressedShowPopup
    
    private void mousePressedCheckForPopup(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_mousePressedCheckForPopup
        // Add your handling code here:
        if ( evt.getButton() == evt.BUTTON2 && !jPopupMenu1.isVisible() )
        {}
        
        
    }//GEN-LAST:event_mousePressedCheckForPopup
    
    void reconfigureColumns() {
        for (int i = 0; i < jTable1.getModel().getColumnCount(); ++i) {
            if (  ! (getModel() instanceof ListObjectTableModel))
                continue;
           
            ListObjectTableModel model = (ListObjectTableModel)  getModel();
            Class dataClass = model.getColumnPropertyDescriptors()[i].getPropertyType();
            Logger.global.info("dataClass of column " + Integer.toString(i) + "= " + dataClass.getName() );
            if ( java.util.Date.class.isAssignableFrom(dataClass))
                jTable1.getColumnModel().getColumn(i).setCellRenderer(new ShortDateCellRenderer());
            
        }
        
    }
    
    public void setModel( TableModel model) {
        jTable1.setModel(model);
        reconfigureColumns();
        
    }
    
    
    public TableModel getModel() {
        return jTable1.getModel();
    }
    
    
    
    public JTable getTable() {
        return jTable1;
    }
    
    public void addMenuItem(Action action) {
        jPopupMenu1.add(action);
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenuItem add_jMenuItem1;
    private javax.swing.JMenuItem delete_jMenuItem2;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    // End of variables declaration//GEN-END:variables
    
}
