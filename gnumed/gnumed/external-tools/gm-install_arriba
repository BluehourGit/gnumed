#!/bin/sh

# ===========================================================
# Fetch and install ARRIBA.
#
#	http://www.arriba-hausarzt.de
#	http://www.arriba-hausarzt.de/material/software.html
#
# $Source: /home/ncq/Projekte/cvs2git/vcs-mirror/gnumed/gnumed/external-tools/gm-install_arriba,v $
# $Id: gm-install_arriba,v 1.4 2009-12-21 15:13:56 ncq Exp $
# ===========================================================

JAR_VER="2.0.3"

# ===========================================================
DL_SOURCE_URL="http://www.arriba-hausarzt.de/downloads/arriba.jar"
DL_JAR_NAME="arriba.jar"
DL_TARGET_DIR="/tmp"
APP_NAME="arriba"
VERSIONED_JAR_NAME="${APP_NAME}-${JAR_VER}.jar"
INSTALL_BASE="/usr/local/bin"
WRAPPER_NAME=${DL_TARGET_DIR}/${APP_NAME}


# get jar
wget -c ${DL_SOURCE_URL} -P ${DL_TARGET_DIR}/
mv ${DL_TARGET_DIR}/${DL_JAR_NAME} ${DL_TARGET_DIR}/${VERSIONED_JAR_NAME}


# create wrapper
echo "#!/bin/sh"									> ${WRAPPER_NAME}
echo ""												>> ${WRAPPER_NAME}
echo "java -jar  ${INSTALL_BASE}/${APP_NAME}.jar"	>> ${WRAPPER_NAME}
echo ""												>> ${WRAPPER_NAME}
echo "# ======================================="	>> ${WRAPPER_NAME}
echo "# \$Id: gm-install_arriba,v 1.4 2009-12-21 15:13:56 ncq Exp $"						>> ${WRAPPER_NAME}
chmod +x ${WRAPPER_NAME}


# install jar
echo "Sie m端ssen jetzt das Passwort f端r root eingeben:"
su -c "mv -vf ${WRAPPER_NAME} ${INSTALL_BASE}/${APP_NAME} && mv -vf ${DL_TARGET_DIR}/${VERSIONED_JAR_NAME} ${INSTALL_BASE}/${VERSIONED_JAR_NAME} && ln -f -s -v ${INSTALL_BASE}/${VERSIONED_JAR_NAME} ${INSTALL_BASE}/${APP_NAME}.jar"


# remove old jars ?
echo ""
read -e -p "Alte ARRIBA-Versionen entfernen ? [j/N]: "
if test "${REPLY}" == "j" ; then

	OLD_JARS="/usr/bin/arriba*"

	echo "Sie m端ssen jetzt das Passwort f端r root eingeben:"
	su -c "rm -v -f ${OLD_JARS}"
fi


exit 0
# ===========================================================
# $Log: gm-install_arriba,v $
# Revision 1.4  2009-12-21 15:13:56  ncq
# - ARRIBA 2.0.3 is here
# - create java wrapper
# - cleanup
#
# Revision 1.3  2009/08/24 20:11:27  ncq
# - bump db version
# - fix tag creation
# - provider inbox:
# 	enable filter-to-active-patient,
# 	listen to new signal,
# 	use cInboxMessage class
# - properly constrain LOINC phrasewheel SQL
# - include v12 scripts in release
# - install arriba jar to /usr/local/bin/
# - check for table existence in audit schema generator
# - include dem.message inbox with additional generic signals
#
# Revision 1.2  2009/04/23 13:05:16  ncq
# - cleanup
#
# Revision 1.1  2009/04/23 13:04:04  ncq
# - new
#
#