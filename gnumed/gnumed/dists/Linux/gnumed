#!/bin/sh
OPTIONS=$@

name=`basename $0`
CONFSOURCE=/etc/gnumed/${name}.conf

# set -x

# check for explicite conffile option
if echo $OPTIONS | grep -q -- "--conf-file[[:space:]]*=" ; then
    CONFFILE=`echo $OPTIONS | sed -e 's/^.*--conf-file[[:space:]]*=[[:space:]]*\([^[:space:]]\+\).*/\1/'`
    if [ ! -s ${CONFFILE} ] ; then
        echo "Given config file ${CONFFILE} missing."
	exit
    fi
    CONFFILE="--conf-file=${CONFFILE}"
    OPTIONS=`echo $OPTIONS | sed -e 's/--conf-file[[:space:]]*=[[:space:]]*[^[:space:]]\+//'`
else
    # copy global config file to user directory because /etc/gnumed is not writable
    if [ ! -s ${HOME}/.gnumed/${name}.conf ] ; then
        if [ ! -e ${CONFSOURCE} ] ; then
	    echo "Global config file ${CONFSOURCE} missing."
	    exit
	fi
        cp -a ${CONFSOURCE} ${HOME}/.gnumed/${name}.conf
    fi
    CONFFILE="--conf-file=${HOME}/.gnumed/${name}.conf"
fi

# check for explicite --unicode-gettext option
if echo $OPTIONS | grep -q -- "--unicode-gettext[[:space:]]*=" ; then
    ## just for debugging
    echo $OPTIONS
else
    OPTIONS="--unicode-gettext=0 $OPTIONS"
fi

export PYTHONPATH="${PYTHONPATH}:/usr/lib/python/site-packages/Gnumed:/usr/lib/python/site-packages/Gnumed/wxpython:/usr/lib/python/site-packages/Gnumed/pycommon"
python /usr/lib/python/site-packages/Gnumed/wxpython/gnumed.py ${CONFFILE} ${OPTIONS}
