%------------------------------------------------------------------
% Medikationsplan gemäß AMTS 2.0
%
% License: GPL v2 or later
%
% requires pdflatex to be run with -recorder option
%------------------------------------------------------------------

% debugging
\listfiles
\errorcontextlines 10000

\documentclass[
	version=last,
	paper=landscape,
	paper=a4,
	DIV=9,								% help typearea find a good Satzspiegel
	BCOR=0mm,							% keine BindeCORrektur
	fontsize=12pt,						% per spec
	parskip=full,						% Absätze mit Leerzeilen trennen, kein Einzug
	headsepline=off,
	footsepline=off,
	titlepage=false
]{scrartcl}

%------------------------------------------------------------------
% packages
\usepackage{scrlayer-scrpage}			% Kopf- und Fußzeilen
\usepackage{geometry}					% setup margins
\usepackage{microtype}					% micro-adjustments to typesetting
\usepackage[cjkjis,graphics]{ucs}		% lots of UTF8 symbols, breaks with xelatex
\usepackage[T1]{fontenc}				% fonts are T1
\usepackage[ngerman]{babel}				% Deutsch und Trennung
\usepackage[utf8x]{inputenc}			% content is UTF8, breaks with xelatex
\usepackage{textcomp}					% Symbole für Textmodus zum Escapen
\usepackage{ragged2e}					% improved alignment, needed for raggedleft in header table cell
\usepackage{tabularx}					% bessere Tabellen
\usepackage{tabu}						% bessere Tabellen
\usepackage{longtable}					% Tabellen über mehrere Seiten
\usepackage{helvet}						% Arial alike Helvetica
\usepackage{lastpage}					% easy access to page number of last page
\usepackage{embedfile}					% store copy of data file for producing data matrix inside PDF
\usepackage{array}						% improved column styles
\usepackage[abspath]{currfile}			% generically refer to input file
%\usepackage{qrcode}					% used to create the 2D data matrix
\usepackage{hyperref}					% aktive URLs

% debugging:
%\usepackage{showkeys}

%\usepackage{marvosym}					% Symbole: Handy, Telefon, E-Mail
%\usepackage{graphicx}					% Grafiken laden (Logo und Unterschrift)
%\usepackage[space]{grffile}			% besserer Zugriff auf Grafikdateien
%\usepackage{calc}						% \widthof (für signature)

%------------------------------------------------------------------
% setup:
% - debugging
\tracingtabu=2

% - precise positioning of things to satisfy spec
\setlength{\tabcolsep}{0pt}
\setlength{\parskip}{0pt}
\setlength{\topskip}{0pt}
\setlength{\marginparwidth}{0pt}
\setlength{\marginparsep}{0pt}

% - page
\geometry{
	verbose,
	% debugging:
%	showframe,											% show page frames
%	showcrop,											% show crop marks
	a4paper,
	landscape,
	includehead=true,
	headheight=4cm,
	headsep=0pt,
	includefoot=true,									% make margins absolute
	footskip=1cm,										% per spec
	left=0.8cm,right=0.8cm,top=0.8cm,bottom=0.8cm		% per spec
}

% - font: Arial (Helvetica)
\renewcommand{\rmdefault}{phv}
\renewcommand{\sfdefault}{phv}

% - data matrix
%\qrset{level=Q}
%\qrset{version=15}


% - header = top part
\lohead{
	\upshape
	% debugging (with vertical lines):
	%\begin{tabu} to \textwidth {p{7cm}|X[-1,L]|@{\hspace{1cm}}|X[-1,R]|p{4.3cm}}
	\begin{tabu} to \textwidth {p{7cm}X[-1,L]@{\hspace{1cm}}X[-1,R]p{4.3cm}}
			{\fontsize{20pt}{22pt}\selectfont \textbf{Medikationsplan}}\newline
			\ \newline
			{\fontsize{14pt}{16pt}\selectfont Seite \thepage\ von \pageref{LastPage}}
		&
			\fontsize{14pt}{16pt}\selectfont
			für:\ \textbf{$<name::%(firstnames)s %(lastnames)s::1-37>$} \newline
			$<name::\textbf{%(firstnames)s %(lastnames)s}::38-90>$\  \newline
			ausgedruckt von: $<current_provider::::30>$ \newline
			\href{http://$<praxis_comm::web::>$}{$<praxis::%(branch)s, %(praxis)s::50>$} \newline
			% use \mbox{...} to prevent ... from getting hyphenated
			\mbox{$<praxis_address::%(street)s %(number)s %(subunit)s,%(postcode)s %(urb)s::55>$}\ \newline
			$<praxis_comm::workphone::20>$\ \newline
			{\fontsize{12pt}{14pt}\selectfont \href{mailto:$<praxis_comm::email::>$}{$<praxis_comm::email::80>$}\ }
		&
			\fontsize{14pt}{16pt}\selectfont
			geb.\ am: \textbf{$<date_of_birth::%d.%m.%Y::10>$}\newline
			\ \newline
			\ \newline
			\ \newline											%Gewicht: 125 kg\newline		::25
			\ \newline											%schwanger / stillend\newline	::25
			Allergie: $<allergy_state::::15>$\newline			%Allergie: Katzenhaare\newline
			ausgedruckt am: $<today::%d.%m.%Y::10>$
		&
			% debugging:
			%---data matrix---
		\tabularnewline
	\end{tabu}
}
%\lehead{test}
%\cehead{}
%\cohead{}
%\rehead{}
%\rohead{}


% footer setup = bottom part
\lofoot{{
	\begin{tabular}[t]{p{6cm}p{17cm}p{5cm}}
		\hline
		{	% left side: Versionsinformationen
			\raggedright
			\fontsize{10pt}{12pt}\selectfont
			\upshape
			DE-DE-Version 2.0 vom 15.12.2014
		} & {
			% middle part: Herstellerfeld
			\parbox[t][1cm][t]{17cm}{
				\centering
				GNUmed $<client_version::::>$ -- \href{http://www.gnumed.org}{www.gnumed.org}
			}
		} & {
			% right side: Freifeld, must be empty
			% debugging:
			%---Freifeld---
		}
	\end{tabular}
}}
\lefoot{{
	\begin{tabular}[t]{p{6cm}p{17cm}p{5cm}}
		\hline
		{	% left side: Versionsinformationen
			\raggedright
			\fontsize{10pt}{12pt}\selectfont
			\upshape
			DE-DE-Version 2.0 vom 15.12.2014
		} & {
			% middle part: Herstellerfeld
			\parbox[t][1cm][t]{17cm}{
				\centering
				GNUmed $<client_version::::>$ -- \href{http://www.gnumed.org}{www.gnumed.org}
			}
		} & {
			% right side: Freifeld, must be empty
			% debugging:
			%---Freifeld---
		}
	\end{tabular}
}}
\cefoot{}
\cofoot{}
\refoot{}
\rofoot{}


\begin{document}


% middle part: Medikationsliste
\begin{longtable} {|
	p{4cm}|		% Wirkstoff
	p{4.4cm}|	% Handelsname
	p{1.8cm}|	% Stärke
	p{1.8cm}|	% Form
	p{0.8cm}|	% Dosierung: morgens
	p{0.8cm}|	% Dosierung: mittags
	p{0.8cm}|	% Dosierung: abends
	p{0.8cm}|	% Dosierung: zur Nacht
	p{2cm}|		% Einheit
	p{6.4cm}|	% Hinweise
	p{4.3cm}|	% Grund
}
% Tabellenkopf:
\hline
{
	\fontsize{12pt}{14pt}\selectfont
	\centering Wirkstoff &
	\centering Handelsname &
	\centering Stärke &
	\centering Form &
	\centering Mo &
	\centering Mi &
	\centering Ab &
	\centering zN &
	\centering Einheit &
	\centering Hinweise &
	\centering Grund
}
\endhead
\hline
\endfoot
\hline
\endlastfoot
% Tabelleninhalt:
\hline
{
	\fontsize{12pt}{14pt}\selectfont
	$<current_meds_AMTS::::999999999>$
}
\end{longtable}


% include data in PDF for easier processing:

% 1) data file from which QR code was generated
%\embedfile[
%	desc=Medikationsplan als QR-Code-Datendatei,
%	mimetype=text/plain
%]{./qr-code-data-file.txt}

% 2) LaTeX source code from which the PDF was produced
\embedfile[
	desc=Medikationsplan als LaTeX-Quellcode,
	mimetype=text/plain
]{\currfileabspath}

% 3) QR code as PNG
%\embedfile[
%	desc=QR-Code des Medikationsplan als PNG-Datei,
%	mimetype=image/png
%]{qr-code.png}

% 4) VCF of creator
%\embedfile[
%	desc=digitale Visitenkarte des Erstellers,
%	mimetype=text/vcf
%]{praxis.vcf}


\end{document}
%------------------------------------------------------------------
